<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forum Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="chat-container">
    <div id="messages"></div>
    <input type="text" id="messageInput" placeholder="Ketik pesan...">
    <button id="send">Kirim</button>
  </div>

  <script type="module">
    import { auth, db } from "./firebase.js";
    import { collection, addDoc, onSnapshot, serverTimestamp, query, orderBy } 
      from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
    import { onAuthStateChanged } 
      from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

    const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("messageInput");
    const sendBtn = document.getElementById("send");

    let currentUser = null;

    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        loadMessages();
      } else {
        window.location.href = "index.html";
      }
    });

    sendBtn.onclick = async () => {
      if (!input.value) return;
      await addDoc(collection(db, "messages"), {
        text: input.value,
        uid: currentUser.uid,
        email: currentUser.email,
        createdAt: serverTimestamp()
      });
      input.value = "";
    };

    function loadMessages() {
      const q = query(collection(db, "messages"), orderBy("createdAt"));
      onSnapshot(q, snapshot => {
        messagesDiv.innerHTML = "";
        snapshot.forEach(doc => {
          const msg = doc.data();
          const div = document.createElement("div");
          div.className = msg.uid === currentUser.uid ? "my-message" : "other-message";
          div.innerText = `${msg.email}: ${msg.text}`;
          messagesDiv.appendChild(div);
        });
      });
    }
  </script>
</body>
</html>
